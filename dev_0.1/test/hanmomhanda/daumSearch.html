<!DOCTYPE html>
<html lang='ko'>
<head>
    <title>TODO supply a title</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<form method='post' action='http://apis.daum.net/search/book'>
</form>
<script src="http://projectbs.github.io/bsJS/bsjs.0.3.js"></script>
<script>
bs( function(){
//var _postTarget = 'http://apexsoft-svr1.iptime.org/bsJScorsProxy/dev_0.1/test/hanmomhanda/corsproxy0.1.php'
var _postTarget = 'http://api.bsplugin.com/corsproxy/dev_0.1/corsproxy0.1.php'
  , data = {
        'apikey' : 'DAUM_SEARCH_DEMO_APIKEY',
        'q' : '리눅스',
        'output' : 'json',
        'url' : document.forms[0].action,
        'customheader' : 'CUSTOM_HEADER',
        'method' : 'POST'
    }
;

bs.Dom( '<div></div>' ).S( 
    '<', 'body', // body를 부모로
    'html', 'bsCORS', // html 입력
    'width', 300, // 스타일 지정
    'click', bsCORS // 이벤트 등록
);

bs.Dom( '<div></div>' ).S( 
    '<', 'body', // body를 부모로
    'html', 'pureCORS', // html 입력
    'width', 300, // 스타일 지정
    'click', pureCORS // 이벤트 등록
);
    
bs.Dom( '<div></div>' ).S( 
    '<', 'body', // body를 부모로
    'html', 'directCORS', // html 입력
    'width', 300, // 스타일 지정
    'click', directCORS // 이벤트 등록
);

bs.Dom( '<div></div>' ).S( 
    '<', 'body', // body를 부모로
    'html', 'ClearResult', // html 입력
    'width', 300, // 스타일 지정
    'click', clearResult // 이벤트 등록
);

bs.Dom('<hr>').S( '<', 'body');
bs.Dom('<span id="result"></span>').S( '<', 'body');

function end(data) {
    bs.Dom('#result').S('html', data);
}

function bsCORS() {

    bs.post(end, _postTarget, 
        'apikey', 'DAUM_SEARCH_DEMO_APIKEY',
        'q', '리눅스',
        'output', 'json',
        'url', document.forms[0].action,
        'customheader', 'CUSTOM_HEADER',
        'method', 'POST');
}

function pureCORS() {
    var xhr = getXHR()
    ;
    xhr.onreadystatechange = function() {
        handleStateChange(xhr);
    };
    xhr.open("POST", _postTarget, true);
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
    xhr.send( 'postdata='+JSON.stringify(data) );
}

function directCORS() {
    var xhr = getXHR();
    xhr.onreadystatechange = function() { handleStateChange(xhr); };
    xhr.open("POST", document.forms[0].action, true);
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
    xhr.send( 'postdata='+JSON.stringify(data) );
}

function clearResult() {
    bs.Dom('#result').S('html', '');
}

function handleStateChange(xhr) {
    if (xhr.readyState == 4 ) {
        if (xhr.status == 200 ) {
            console.dir(xhr);
            end(xhr.responseText);
        }
    }
}

function getXHR() {
    if (window.ActiveXObject) {
        return new ActiveXObject("Microsoft.XMLHTTP");
    } else if (window.XMLHttpRequest) {
        return new XMLHttpRequest();
    }
}

} );
</script>
</body>
</html>